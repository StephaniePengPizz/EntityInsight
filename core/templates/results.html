{% extends "base.html" %}
{% load markdownify %}

{% block extra_head %}
<script type="module">
  import mermaid from 'https://cdn.jsdelivr.net/npm/mermaid@10/dist/mermaid.esm.min.mjs';
  mermaid.initialize({ startOnLoad: true });

  window.addEventListener('load', () => {
    mermaid.init();
  });
</script>
<style>
  /* 主容器布局 */
  .container-output-page {
    display: grid;
    grid-template-columns: 1fr 1fr;
    grid-template-rows: auto auto;
    gap: 20px;
    align-items: stretch;
    min-height: 100vh;
  }
  
  /* 统一卡片样式 */
  .graph-section, .path-section, 
  .summary-section, .news-section {
    background: white;
    border-radius: 8px;
    box-shadow: 0 2px 4px rgba(0,0,0,0.1);
    padding: 20px;
    display: flex;
    flex-direction: column;
    height: 100%;
  }
  
  /* 标题样式 */
  .section-title {
    color: #2a5885;
    border-bottom: 2px solid #e1e8ed;
    padding-bottom: 10px;
    margin-bottom: 15px;
  }
  
  /* 路径分析样式 */
  .path-meta {
    background-color: #f0f8ff;
    padding: 15px;
    border-radius: 5px;
    margin-bottom: 15px;
  }
  
  /* 摘要内容折叠效果 */
  .summary-content {
    flex: 1;
    overflow: hidden;
    position: relative;
    transition: all 0.3s ease;
  }
  
  .summary-content.collapsed {
    max-height: 200px;
  }
  
  .summary-content.expanded {
    max-height: none;
  }
  
  .summary-content.collapsed::after {
    content: "";
    position: absolute;
    bottom: 0;
    left: 0;
    right: 0;
    height: 30px;
    background: linear-gradient(to bottom, transparent, white);
  }
  
  /* 新闻项样式 */
  .news-item {
    padding: 10px 0;
    border-bottom: 1px solid #eee;
  }
  
  .news-item:last-child {
    border-bottom: none;
  }
  
  /* 展开/折叠按钮 */
  .toggle-btn {
    display: block;
    text-align: center;
    padding: 8px;
    background: #e1e8ed;
    color: #2a5885;
    border-radius: 5px;
    margin-top: 15px;
    cursor: pointer;
    transition: background 0.3s;
  }
  
  .toggle-btn:hover {
    background: #d1d8e0;
  }
</style>
{% endblock %}

{% block content %}
<div class="container-output-page">
    <!-- 左上: 知识图谱 -->
    <div class="graph-section">
        <h2 class="section-title">Knowledge Graph For Financial Entity Regulator</h2>
        <div class="mermaid">
            {{ graph_description|safe }}
        </div>
    </div>

    <!-- 右上: AI摘要 -->
    <div class="summary-section">
        <h2 class="section-title">AI Summary for Payments News</h2>
        <div class="summary-content collapsed" id="summaryContent">
            <p>The payments and banking sector has seen notable regulatory developments in recent weeks, with heightened scrutiny on compliance and capital requirements. Two key events—a significant SEC fine against Bank of America and new banking capital rules—highlight evolving regulatory pressures and their implications for financial institutions.</p>
            
            <h4>Key Findings</h4>
            <p>First, the SEC fined Bank of America $25 million for reporting violations, underscoring regulators' focus on transparency and accuracy in financial disclosures. Second, new capital requirements for banks were announced, likely aimed at strengthening financial stability but potentially increasing operational costs.</p>
            
            <p>These developments reflect a broader trend of tightening oversight, with major institutions like Bank of America and systematic banks affected by the changes.</p>
        </div>
        <div class="toggle-btn" id="toggleSummary">Read More</div>
    </div>

    <!-- 左下: 路径分析 -->
    <div class="path-section">
        <h2 class="section-title">Path Analysis</h2>
        <div class="path-meta">
            <p><strong>Source:</strong> hong kong</p>
            <p><strong>Target Types:</strong> Regulator</p>
            <p><strong>Cutoff:</strong> 3</p>
            <p><strong>Number of Paths:</strong> 5</p>
        </div>
        
        <!-- 这里应该是动态生成的路径列表 -->
        <div class="path-item">
            <h4>Path #1 (Avg Weight: 0.85)</h4>
            <p><strong>Nodes:</strong> Node A → Node B → Node C</p>
            <p><strong>Relations:</strong> Relation 1 → Relation 2</p>
        </div>
    </div>

    <!-- 右下: 相关新闻 -->
    <div class="news-section">
        <h2 class="section-title">Related News</h2>
        <div class="news-content collapsed" id="newsContent">
            <div class="news-item">
                <div class="news-title">SEC fines Bank of America $25M for reporting violations</div>
                <div class="news-source">Financial Times</div>
            </div>
            <div class="news-item">
                <div class="news-title">New banking capital requirements announced</div>
                <div class="news-source">Reuters</div>
            </div>
        </div>
        <div class="toggle-btn" id="toggleNews">Read More</div>
    </div>
</div>

<script>
document.addEventListener('DOMContentLoaded', function() {
    // 摘要展开/折叠
    const summaryToggle = document.getElementById('toggleSummary');
    const summaryContent = document.getElementById('summaryContent');
    
    if (summaryToggle && summaryContent) {
        summaryToggle.addEventListener('click', function() {
            summaryContent.classList.toggle('collapsed');
            summaryContent.classList.toggle('expanded');
            this.textContent = summaryContent.classList.contains('collapsed') ? 'Read More' : 'Read Less';
        });
    }
    
    // 新闻展开/折叠
    const newsToggle = document.getElementById('toggleNews');
    const newsContent = document.getElementById('newsContent');
    
    if (newsToggle && newsContent) {
        newsToggle.addEventListener('click', function() {
            newsContent.classList.toggle('collapsed');
            newsContent.classList.toggle('expanded');
            this.textContent = newsContent.classList.contains('collapsed') ? 'Read More' : 'Read Less';
        });
    }
});
</script>
{% endblock %}